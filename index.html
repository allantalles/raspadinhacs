<!DOCTYPE html>
<html>
<head>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background: #1a1a1a;
            font-family: Arial, sans-serif;
            color: white;
        }
        #game-container {
            text-align: center;
        }
        #canvas {
            border: 2px solid #444;
            cursor: pointer;
            background: white;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        #result {
            margin-top: 20px;
            font-size: 24px;
            color: #4CAF50;
        }
        .button-disabled {
            background: #666 !important;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="game-container">
        <h2>Raspadinha CS2</h2>
        <canvas id="canvas" width="300" height="150"></canvas>
        <div>
            <button id="newGame">Nova Raspadinha</button>
        </div>
        <div id="result"></div>
    </div>

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');
        const newGameBtn = document.getElementById('newGame');
        const resultDiv = document.getElementById('result');
        let isDrawing = false;
        let isAnimating = false;
        
        const prizes = [
            // Consumer Grade (Azul) - 35%
            { name: 'MP9 | Food Chain', probability: 20 },
            { name: 'MAC-10 | Ensnared', probability: 15 },
            
            // Industrial Grade (Azul Claro) - 30%
            { name: 'P250 | Re.built', probability: 15 },
            { name: 'G3SG1 | Digital Mesh', probability: 15 },
            
            // Mil-Spec (Azul Escuro) - 20%
            { name: 'M4A4 | Spider Lily', probability: 10 },
            { name: 'Desert Eagle | Ocean Drive', probability: 10 },
            
            // Restricted (Roxo) - 10%
            { name: 'AK-47 | Ice Coaled', probability: 5 },
            { name: 'AWP | Duality', probability: 5 },
            
            // Classified (Rosa) - 4%
            { name: 'M4A1-S | Printstream', probability: 4 },
            
            // Covert (Vermelho) - 1%
            { name: 'AWP | Dragon Lore', probability: 1 }
        ];

        function getRandomPrize() {
            const random = Math.random() * 100;
            let sum = 0;
            
            for (const prize of prizes) {
                sum += prize.probability;
                if (random <= sum) {
                    return prize.name;
                }
            }
            return prizes[0].name;
        }

        function initGame() {
            if (isAnimating) return;
            
            isAnimating = true;
            newGameBtn.classList.add('button-disabled');
            
            // Limpa o canvas
            ctx.fillStyle = '#c0c0c0';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Adiciona textura
            for (let i = 0; i < 5000; i++) {
                ctx.fillStyle = `rgba(180, 180, 180, ${Math.random() * 0.4})`;
                ctx.fillRect(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    2,
                    2
                );
            }
            
            // Reseta o resultado
            resultDiv.textContent = '';
            
            // Inicia animação de raspagem automática
            let positions = [];
            for (let i = 0; i < 50; i++) {
                positions.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height
                });
            }
            
            let frame = 0;
            function animate() {
                if (frame >= positions.length) {
                    isAnimating = false;
                    newGameBtn.classList.remove('button-disabled');
                    const prize = getRandomPrize();
                    resultDiv.textContent = `Parabéns! Você ganhou: ${prize}`;
                    return;
                }
                
                ctx.globalCompositeOperation = 'destination-out';
                for (let i = 0; i < 3; i++) {
                    if (frame + i < positions.length) {
                        const pos = positions[frame + i];
                        ctx.beginPath();
                        ctx.arc(pos.x, pos.y, 15, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }
                
                frame += 3;
                requestAnimationFrame(animate);
            }
            
            animate();
        }

        function calculateRevealedPercentage() {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const pixels = imageData.data;
            let transparentPixels = 0;
            
            for (let i = 3; i < pixels.length; i += 4) {
                if (pixels[i] < 100) transparentPixels++;
            }
            
            return (transparentPixels / (canvas.width * canvas.height)) * 100;
        }

        function reveal() {
            if (isAnimating) return;
            
            const revealed = calculateRevealedPercentage();
            if (revealed > 50 && !resultDiv.textContent) {
                const prize = getRandomPrize();
                resultDiv.textContent = `Parabéns! Você ganhou: ${prize}`;
            }
        }

        canvas.addEventListener('mousedown', () => {
            if (!isAnimating) isDrawing = true;
        });
        
        canvas.addEventListener('mouseup', () => {
            isDrawing = false;
            if (!isAnimating) reveal();
        });
        
        canvas.addEventListener('mousemove', (e) => {
            if (!isDrawing || isAnimating) return;
            
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            ctx.globalCompositeOperation = 'destination-out';
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, Math.PI * 2);
            ctx.fill();
        });

        newGameBtn.addEventListener('click', initGame);
        
        // Inicializa o primeiro jogo
        initGame();
    </script>
</body>
</html>
